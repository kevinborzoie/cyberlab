<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Cyber Security Lab: CAN Bus Injection</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Link External CSS -->
    <link rel="stylesheet" href="style.css">
    
</head>
<body class="p-4 md:p-8 min-h-screen">

    <div id="app" class="max-w-7xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-indigo-700">EV Cybersecurity Simulation Lab</h1>
            <p class="text-lg text-gray-600 mt-2">Module: CAN Bus Injection - Limp Mode Attack</p>
        </header>

        <!-- LAB SCENARIO -->
        <div class="card bg-white p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Scenario Briefing</h2>
            <p class="text-gray-700 mb-4">
                The **Motor Control Unit (MCU)** of a new Hybrid Electric Vehicle (HEV) is experiencing issues. The driver reports sudden, drastic power throttling and a persistent **Low Battery Warning**, even though the car was fully charged just hours ago. The vehicle has automatically entered "Limp Mode" for safety. Your task is to analyze the system diagnostics and the raw in-vehicle network traffic to identify the security flaw and propose a solution, leveraging your knowledge of network and security protocols.
            </p>
            <div class="flex flex-wrap gap-4 text-sm font-medium">
                <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full">Network+ Focus: CAN Protocol (Unauthenticated Broadcast)</span>
                <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full">Security+ Focus: Spoofing/Injection Attacks on OT Systems</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- CAR STATE DASHBOARD -->
            <div class="lg:col-span-1 card bg-gray-800 p-6 text-white h-full">
                <h2 class="text-xl font-bold mb-4 border-b border-gray-600 pb-2">Vehicle Diagnostics Dashboard (MCU View)</h2>
                <div id="state-display" class="space-y-4">
                    <!-- Dynamic state updates here -->
                </div>
                <div id="status-message" class="mt-6 p-3 rounded-lg font-semibold text-center hidden"></div>
            </div>

            <!-- CAN BUS NETWORK LOG -->
            <div class="lg:col-span-2 card bg-white p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">CAN Bus Monitor (Raw Traffic)</h2>
                <p class="text-sm text-gray-500 mb-2">Logs show periodic messages (every 100ms) for critical vehicle state (ID, Data).</p>
                <div class="bg-gray-900 text-green-400 p-3 h-96 overflow-y-scroll text-xs rounded-lg font-mono" id="can-log">
                    <!-- Log entries will appear here -->
                </div>
            </div>
        </div>

        <!-- CHALLENGE QUESTIONS & ANSWER AREA -->
        <div class="card bg-white p-6 mt-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b pb-2">Student Challenge</h2>

            <div class="space-y-6">
                <!-- Question 1 -->
                <div>
                    <p class="font-semibold text-lg mb-2">Q1: Based on the "Vehicle Diagnostics Dashboard" and the "CAN Bus Monitor," what is the primary security vulnerability being exploited?</p>
                    <ul class="space-y-2 text-gray-700">
                        <li><input type="radio" name="q1" value="A" id="q1a"> <label for="q1a">A) DoS Attack (Too much traffic is blocking legitimate messages).</label></li>
                        <li><input type="radio" name="q1" value="B" id="q1b"> <label for="q1b">B) Replay Attack (Attacker is sending an old, legitimate low-battery message).</label></li>
                        <li><input type="radio" name="q1" value="C" id="q1c"> <label for="q1c">C) Message Spoofing/Injection (An unauthorized node is broadcasting fake, high-priority messages).</label></li>
                        <li><input type="radio" name="q1" value="D" id="q1d"> <label for="q1d">D) GPS Spoofing (The navigation system is malfunctioning).</label></li>
                    </ul>
                </div>

                <!-- Question 2 -->
                <div>
                    <p class="font-semibold text-lg mb-2">Q2: The malicious traffic is primarily affecting which critical Electronic Control Unit (ECU) signal, causing the car to enter Limp Mode?</p>
                    <ul class="space-y-2 text-gray-700">
                        <li><input type="radio" name="q2" value="A" id="q2a"> <label for="q2a">A) Brake Status (CAN ID 0x301)</label></li>
                        <li><input type="radio" name="q2" value="B" id="q2b"> <label for="q2b">B) Actual Battery State (CAN ID 0x101)</label></li>
                        <li><input type="radio" name="q2" value="C" id="q2c"> <label for="q2c">C) Throttle Position (CAN ID 0x205)</label></li>
                        <li><input type="radio" name="q2" value="D" id="q2d"> <label for="q2d">D) Infotainment System Status</label></li>
                    </ul>
                </div>

                <!-- Question 3 (Rectification/Mitigation) -->
                <div>
                    <p class="font-semibold text-lg mb-2">Q3: Propose a high-level mitigation strategy to prevent this type of attack on a future vehicle design. (Security+ concept)</p>
                    <textarea id="mitigation-proposal" class="w-full border-2 border-gray-300 rounded-lg p-3 focus:ring-indigo-500 focus:border-indigo-500" rows="3" placeholder="Explain your proposal (e.g., encryption, authentication, network segmentation)."></textarea>
                </div>
            </div>

            <button onclick="submitAnswers()" class="mt-6 w-full md:w-auto px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition duration-150">
                Submit Analysis & View Results
            </button>
            <div id="results" class="mt-4 p-4 rounded-lg hidden"></div>
        </div>

    </div>

    <!-- JAVASCRIPT LOGIC -->
    <!-- The external script must be loaded after the body content -->
    <script src="simulation.js"></script>
</body>
</html>